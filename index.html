<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>M√≥n Qu√† Gi√°ng Sinh ƒê·∫∑c Bi·ªát D√†nh Cho Em ‚ù§Ô∏è</title>
  <link
    href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Quicksand:wght@400;600&display=swap"
    rel="stylesheet" />
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 0;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #4facfe 75%, #00f2fe 100%);
      background-size: 400% 400%;
      animation: gradientShift 15s ease infinite;
      font-family: "Quicksand", sans-serif;
      overflow: hidden;
      position: relative;
    }

    body::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background:
        radial-gradient(circle at 20% 50%, rgba(255, 107, 157, 0.3) 0%, transparent 50%),
        radial-gradient(circle at 80% 80%, rgba(196, 69, 105, 0.3) 0%, transparent 50%),
        radial-gradient(circle at 40% 20%, rgba(102, 126, 234, 0.2) 0%, transparent 50%);
      z-index: 1;
      pointer-events: none;
    }

    @keyframes gradientShift {
      0% {
        background-position: 0% 50%;
      }

      50% {
        background-position: 100% 50%;
      }

      100% {
        background-position: 0% 50%;
      }
    }

    /* Three.js Canvas */
    #three-canvas {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 5;
      cursor: pointer;
    }

    /* Particle Canvas */
    #canvas-bg {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 2;
      pointer-events: none;
    }

    /* Loading Screen */
    #loading {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: white;
      font-size: 1.5em;
      z-index: 100;
      text-align: center;
    }

    #loading.hidden {
      display: none;
    }

    .loader {
      width: 50px;
      height: 50px;
      border: 5px solid rgba(255, 255, 255, 0.3);
      border-top: 5px solid #ffd700;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 20px auto;
    }

    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }

    .tap-hint {
      position: absolute;
      bottom: 80px;
      left: 50%;
      transform: translateX(-50%);
      color: white;
      font-weight: 600;
      font-size: 1.3em;
      text-shadow: 0 0 10px rgba(255, 107, 157, 0.8);
      animation: bounce 1.5s infinite alternate;
      white-space: nowrap;
      background: rgba(255, 255, 255, 0.15);
      padding: 12px 25px;
      border-radius: 30px;
      backdrop-filter: blur(10px);
      z-index: 10;
      opacity: 1;
      transition: opacity 0.5s;
    }

    .tap-hint.hidden {
      opacity: 0;
      pointer-events: none;
    }

    @keyframes bounce {
      from {
        transform: translateX(-50%) translateY(0);
      }

      to {
        transform: translateX(-50%) translateY(15px);
      }
    }

    /* Content Card */
    .content {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0);
      width: 90%;
      max-width: 650px;
      max-height: 90vh;
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(25px);
      border-radius: 20px;
      padding: 15px;
      border: 2px solid rgba(255, 255, 255, 0.3);
      text-align: center;
      color: white;
      opacity: 0;
      z-index: 20;
      display: flex;
      flex-direction: column;
      align-items: center;
      box-shadow:
        0 0 60px rgba(255, 107, 157, 0.4),
        inset 0 0 40px rgba(255, 255, 255, 0.1);
      overflow: hidden;
    }

    .content.active {
      animation: contentReveal 1s cubic-bezier(0.68, -0.55, 0.265, 1.55) forwards;
    }

    @keyframes contentReveal {
      to {
        transform: translate(-50%, -50%) scale(1);
        opacity: 1;
      }
    }



    h1 {
      font-family: "Dancing Script", cursive;
      font-size: clamp(1.5em, 3.5vw, 2.2em);
      margin: 0 0 8px 0;
      background: linear-gradient(135deg, #ff6b9d, #ffd700, #ff6b9d);
      background-size: 200% 200%;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      animation: gradientText 3s ease infinite;
      filter: drop-shadow(0 0 20px rgba(255, 215, 0, 0.6));
      flex-shrink: 0;
    }

    @keyframes gradientText {

      0%,
      100% {
        background-position: 0% 50%;
      }

      50% {
        background-position: 100% 50%;
      }
    }

    #typewriter {
      font-size: clamp(0.68em, 1.5vw, 0.82em);
      line-height: 1.45;
      text-align: left;
      margin-top: 5px;
      text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
      font-weight: 500;
      width: 100%;
      overflow: hidden;
      flex-shrink: 1;
    }

    /* ========== RESPONSIVE DESIGN ========== */

    /* Large Desktop (1920px+) */
    @media (min-width: 1920px) {
      .content {
        max-width: 750px;
        padding: 20px;
      }
    }

    /* Desktop (1200px - 1919px) */
    @media (min-width: 1200px) and (max-width: 1919px) {
      .content {
        max-width: 650px;
        padding: 18px;
      }
    }

    /* Tablet Landscape (992px - 1199px) */
    @media (min-width: 992px) and (max-width: 1199px) {
      .content {
        max-width: 600px;
        padding: 15px;
      }

      .tap-hint {
        font-size: 1.05em;
        bottom: 55px;
      }
    }

    /* Tablet Portrait (768px - 991px) */
    @media (min-width: 768px) and (max-width: 991px) {
      .content {
        max-width: 550px;
        padding: 14px;
      }

      .tap-hint {
        font-size: 1em;
        bottom: 50px;
        padding: 8px 16px;
      }
    }

    /* Mobile Landscape (576px - 767px) */
    @media (min-width: 576px) and (max-width: 767px) {
      .content {
        width: 95%;
        max-width: 500px;
        padding: 12px;
      }

      .tap-hint {
        font-size: 0.95em;
        bottom: 45px;
        padding: 7px 14px;
      }
    }

    /* Mobile Portrait (up to 575px) */
    @media (max-width: 575px) {
      .content {
        width: 95%;
        padding: 10px;
        border-radius: 15px;
        max-height: 90vh;
      }

      .tap-hint {
        font-size: 0.9em;
        bottom: 40px;
        padding: 6px 12px;
        border-radius: 15px;
        white-space: normal;
        text-align: center;
        max-width: 90%;
      }

      .loader {
        width: 35px;
        height: 35px;
        border-width: 3px;
      }

      #loading {
        font-size: 1em;
      }
    }

    /* Extra Small Mobile (up to 375px) */
    @media (max-width: 375px) {
      .content {
        padding: 8px;
        max-height: 92vh;
      }

      .tap-hint {
        font-size: 0.85em;
        bottom: 35px;
        padding: 5px 10px;
      }
    }

    /* Landscape Orientation Adjustments */
    @media (max-height: 600px) and (orientation: landscape) {
      .content {
        padding: 6px;
        max-height: 94vh;
      }

      h1 {
        margin-bottom: 4px;
      }

      #typewriter {
        line-height: 1.35;
      }

      .tap-hint {
        bottom: 20px;
        font-size: 0.8em;
        padding: 5px 10px;
      }
    }

    /* Touch Device Optimizations */
    @media (hover: none) and (pointer: coarse) {
      .tap-hint {
        animation: bounce 1s infinite alternate;
      }

      #three-canvas {
        touch-action: none;
      }

      .content {
        -webkit-overflow-scrolling: touch;
      }
    }

    /* ========== SETTINGS BUTTON ========== */
    .settings-btn {
      position: fixed;
      top: 20px;
      right: 20px;
      width: 50px;
      height: 50px;
      background: rgba(255, 255, 255, 0.2);
      backdrop-filter: blur(10px);
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      z-index: 100;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    }

    .settings-btn:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: rotate(90deg) scale(1.1);
      box-shadow: 0 6px 20px rgba(255, 107, 157, 0.4);
    }

    .settings-btn svg {
      width: 28px;
      height: 28px;
      fill: white;
      filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.3));
    }

    /* Settings Modal */
    .settings-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(5px);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 200;
      animation: fadeIn 0.3s ease;
    }

    .settings-modal.active {
      display: flex;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
      }

      to {
        opacity: 1;
      }
    }

    .settings-content {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(20px);
      border-radius: 20px;
      padding: 30px;
      width: 90%;
      max-width: 500px;
      max-height: 80vh;
      overflow-y: auto;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
      animation: slideUp 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    }

    @keyframes slideUp {
      from {
        transform: translateY(50px);
        opacity: 0;
      }

      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .settings-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 2px solid rgba(102, 126, 234, 0.3);
    }

    .settings-header h2 {
      font-family: "Quicksand", sans-serif;
      font-size: 1.5em;
      color: #667eea;
      margin: 0;
    }

    .close-btn {
      background: none;
      border: none;
      font-size: 2em;
      color: #999;
      cursor: pointer;
      line-height: 1;
      padding: 0;
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
    }

    .close-btn:hover {
      color: #ff6b9d;
      transform: rotate(90deg);
    }

    .upload-section {
      margin-bottom: 20px;
    }

    .upload-section h3 {
      font-family: "Quicksand", sans-serif;
      font-size: 1.1em;
      color: #333;
      margin-bottom: 10px;
    }

    .upload-area {
      border: 2px dashed #667eea;
      border-radius: 10px;
      padding: 30px;
      text-align: center;
      background: rgba(102, 126, 234, 0.05);
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .upload-area:hover {
      background: rgba(102, 126, 234, 0.1);
      border-color: #ff6b9d;
    }

    .upload-area p {
      margin: 10px 0;
      color: #666;
      font-size: 0.95em;
    }

    .upload-icon {
      font-size: 3em;
      margin-bottom: 10px;
    }

    #imageInput {
      display: none;
    }

    .image-preview {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
      gap: 10px;
      margin-top: 15px;
    }

    .preview-item {
      position: relative;
      aspect-ratio: 1;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    }

    .preview-item img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .remove-img {
      position: absolute;
      top: 5px;
      right: 5px;
      background: rgba(255, 107, 157, 0.9);
      border: none;
      border-radius: 50%;
      width: 25px;
      height: 25px;
      color: white;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2em;
      line-height: 1;
      transition: all 0.3s ease;
    }

    .remove-img:hover {
      background: #ff6b9d;
      transform: scale(1.1);
    }

    /* Floating Images Background */
    .floating-image {
      position: fixed;
      pointer-events: none;
      z-index: 3;
      opacity: 0;
      border-radius: 20px;
      box-shadow:
        0 10px 40px rgba(0, 0, 0, 0.4),
        0 0 30px rgba(255, 107, 157, 0.3),
        inset 0 0 20px rgba(255, 255, 255, 0.1);
      border: 3px solid rgba(255, 255, 255, 0.6);
      transition: all 0.3s ease;
      filter: brightness(1.05) saturate(1.1);
    }

    .floating-image::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: linear-gradient(45deg,
          transparent,
          rgba(255, 255, 255, 0.1),
          transparent);
      transform: rotate(45deg);
      animation: shimmer 3s infinite;
    }

    @keyframes shimmer {
      0% {
        transform: translateX(-100%) translateY(-100%) rotate(45deg);
      }

      100% {
        transform: translateX(100%) translateY(100%) rotate(45deg);
      }
    }

    /* Share Button */
    .share-btn {
      width: 100%;
      padding: 15px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 12px;
      font-family: "Quicksand", sans-serif;
      font-size: 1em;
      font-weight: 600;
      cursor: pointer;
      margin-top: 20px;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    .share-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
    }

    .share-btn:active {
      transform: translateY(0);
    }

    .share-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    /* Copy Notification */
    .copy-notification {
      position: fixed;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%) translateY(100px);
      background: rgba(102, 126, 234, 0.95);
      color: white;
      padding: 15px 30px;
      border-radius: 50px;
      font-family: "Quicksand", sans-serif;
      font-weight: 600;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
      z-index: 300;
      opacity: 0;
      transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    }

    .copy-notification.show {
      transform: translateX(-50%) translateY(0);
      opacity: 1;
    }

    .share-info {
      background: rgba(102, 126, 234, 0.1);
      border: 1px solid rgba(102, 126, 234, 0.3);
      border-radius: 10px;
      padding: 15px;
      margin-top: 15px;
      font-size: 0.9em;
      color: #555;
      line-height: 1.6;
    }

    .share-info strong {
      color: #667eea;
    }

    @media (max-width: 575px) {
      .settings-btn {
        width: 45px;
        height: 45px;
        top: 15px;
        right: 15px;
      }

      .settings-btn svg {
        width: 24px;
        height: 24px;
      }

      .settings-content {
        padding: 20px;
        width: 95%;
      }

      .settings-header h2 {
        font-size: 1.2em;
      }

      .upload-area {
        padding: 20px;
      }

      .upload-icon {
        font-size: 2.5em;
      }
    }
  </style>
</head>

<body>
  <div id="loading">
    <div class="loader"></div>
    <p>ƒêang t·∫£i m√≥n qu√†...</p>
  </div>

  <audio id="bgMusic" loop>
    <source src="./music/Ariana Grande - Santa Tell Me (Lyrics) - Holiday Pop Classic.mp3" type="audio/mp3" />
  </audio>

  <canvas id="canvas-bg"></canvas>
  <canvas id="three-canvas"></canvas>

  <div class="tap-hint" id="tapHint">‚ú® Nh·∫•n v√†o h·ªôp qu√† ƒëi em! ‚ú®</div>

  <!-- Settings Button -->
  <div class="settings-btn" id="settingsBtn">
    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
      <path
        d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.8,11.69,4.8,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z" />
    </svg>
  </div>

  <!-- Settings Modal -->
  <div class="settings-modal" id="settingsModal">
    <div class="settings-content">
      <div class="settings-header">
        <h2>‚öôÔ∏è C√†i ƒê·∫∑t</h2>
        <button class="close-btn" id="closeModal">&times;</button>
      </div>

      <div class="upload-section">
        <h3>üì∏ Th√™m H√¨nh ·∫¢nh</h3>
        <div class="upload-area" id="uploadArea">
          <div class="upload-icon">üñºÔ∏è</div>
          <p><strong>Nh·∫•n ƒë·ªÉ ch·ªçn h√¨nh ·∫£nh</strong></p>
          <p>ho·∫∑c k√©o th·∫£ file v√†o ƒë√¢y</p>
          <p style="font-size: 0.85em; color: #999;">H·ªó tr·ª£: JPG, PNG, GIF</p>
        </div>
        <input type="file" id="imageInput" accept="image/*" multiple />
        <div class="image-preview" id="imagePreview"></div>

        <button class="share-btn" id="shareBtn" disabled>
          üîó T·∫°o Link Chia S·∫ª
        </button>

        <div class="share-info">
          <strong>üí° H∆∞·ªõng d·∫´n:</strong><br>
          1. Th√™m h√¨nh ·∫£nh b·∫°n mu·ªën<br>
          2. Nh·∫•n "T·∫°o Link Chia S·∫ª"<br>
          3. G·ª≠i link cho ng∆∞·ªùi th√¢n y√™u<br>
          4. Khi h·ªç m·ªü link v√† nh·∫•n v√†o h·ªôp qu√†, h√¨nh ·∫£nh s·∫Ω bung ra! üéÅ
        </div>
      </div>
    </div>
  </div>

  <!-- Copy Notification -->
  <div class="copy-notification" id="copyNotification">
    ‚úì ƒê√£ sao ch√©p link v√†o clipboard!
  </div>

  <div class="content" id="mainContent">
    <h1>Merry Christmas! üéÑüíù</h1>

    <div id="typewriter"></div>
  </div>

  <!-- Three.js Library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <!-- GSAP Animation Library -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

  <script>
    const message = `G·ª≠i ng∆∞·ªùi con g√°i anh y√™u nh·∫•t,<br><br>Gi√°ng sinh n√†y, d√π anh kh√¥ng th·ªÉ bi·∫øn ra tuy·∫øt r∆°i th·∫≠t hay th·∫Øp s√°ng c·∫£ b·∫ßu tr·ªùi sao, nh∆∞ng anh mu·ªën g·ª≠i ƒë·∫øn em ƒëi·ªÅu qu√Ω gi√° nh·∫•t - tr√°i tim v√† t√¨nh y√™u tr·ªçn v·∫πn c·ªßa anh.<br><br>Em bi·∫øt kh√¥ng, m·ªói kho·∫£nh kh·∫Øc b√™n em ƒë·ªÅu l√† m√≥n qu√† tuy·ªát v·ªùi nh·∫•t m√† cu·ªôc ƒë·ªùi trao t·∫∑ng anh. N·ª• c∆∞·ªùi c·ªßa em l√† √°nh s√°ng ·∫•m √°p nh·∫•t trong nh·ªØng ng√†y ƒë√¥ng l·∫°nh gi√°. Ti·∫øng c∆∞·ªùi c·ªßa em l√† giai ƒëi·ªáu ng·ªçt ng√†o nh·∫•t m√† anh t·ª´ng ƒë∆∞·ª£c nghe.<br><br>C·∫£m ∆°n em v√¨ ƒë√£ lu√¥n ·ªü b√™n anh, v√¨ ƒë√£ tin t∆∞·ªüng v√† y√™u th∆∞∆°ng anh. Anh h·ª©a s·∫Ω lu√¥n l√† ch·ªó d·ª±a v·ªØng ch·∫Øc, l√† b·ªù vai ·∫•m √°p ƒë·ªÉ em c√≥ th·ªÉ t·ª±a v√†o m·ªói khi m·ªát m·ªèi.<br><br>Ch√∫c em m·ªôt m√πa Gi√°ng sinh tr√†n ng·∫≠p ni·ªÅm vui, h·∫°nh ph√∫c v√† y√™u th∆∞∆°ng. Mong r·∫±ng n·ª• c∆∞·ªùi lu√¥n n·ªü tr√™n m√¥i em, v√† tr√°i tim em lu√¥n tr√†n ƒë·∫ßy ·∫•m √°p.<br><br>Anh y√™u em v√¥ c√πng, t·ª´ h√¥m qua, h√¥m nay v√† m√£i m√£i v·ªÅ sau! üíñüéÑ‚ú®`;
    const speed = 50;

    // ========== THREE.JS 3D GIFT BOX ==========
    let scene, camera, renderer, giftBox, ribbonV, ribbonH, bow;
    let isOpened = false;

    function initThreeJS() {
      const canvas = document.getElementById('three-canvas');
      scene = new THREE.Scene();

      camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);

      // Responsive camera positioning
      if (window.innerWidth <= 375) {
        // Extra small mobile
        camera.position.set(0, 2, 10);
      } else if (window.innerWidth <= 575) {
        // Mobile portrait
        camera.position.set(0, 2, 9);
      } else if (window.innerWidth <= 767) {
        // Mobile landscape
        camera.position.set(0, 2, 8.5);
      } else if (window.innerWidth <= 991) {
        // Tablet portrait
        camera.position.set(0, 2, 8);
      } else if (window.innerWidth <= 1199) {
        // Tablet landscape
        camera.position.set(0, 2, 7.5);
      } else {
        // Desktop
        camera.position.set(0, 2, 8);
      }

      camera.lookAt(0, 0, 0);

      renderer = new THREE.WebGLRenderer({ canvas, alpha: true, antialias: true });
      renderer.setSize(window.innerWidth, window.innerHeight);
      renderer.shadowMap.enabled = true;
      renderer.shadowMap.type = THREE.PCFSoftShadowMap;

      // Lights
      const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
      scene.add(ambientLight);

      const pointLight1 = new THREE.PointLight(0xffd700, 1, 100);
      pointLight1.position.set(5, 5, 5);
      pointLight1.castShadow = true;
      scene.add(pointLight1);

      const pointLight2 = new THREE.PointLight(0xff6b9d, 0.8, 100);
      pointLight2.position.set(-5, 3, -5);
      scene.add(pointLight2);

      const directionalLight = new THREE.DirectionalLight(0xffffff, 0.5);
      directionalLight.position.set(0, 10, 5);
      directionalLight.castShadow = true;
      scene.add(directionalLight);

      // Gift Box
      const boxGeometry = new THREE.BoxGeometry(2, 2, 2);
      const boxMaterial = new THREE.MeshStandardMaterial({
        color: 0xd63447,
        metalness: 0.3,
        roughness: 0.4
      });
      giftBox = new THREE.Mesh(boxGeometry, boxMaterial);
      giftBox.castShadow = true;
      giftBox.receiveShadow = true;
      scene.add(giftBox);

      // Vertical Ribbon
      const ribbonVGeometry = new THREE.BoxGeometry(0.3, 2.1, 2.1);
      const ribbonMaterial = new THREE.MeshStandardMaterial({
        color: 0xffd700,
        metalness: 0.7,
        roughness: 0.2,
        emissive: 0xffd700,
        emissiveIntensity: 0.2
      });
      ribbonV = new THREE.Mesh(ribbonVGeometry, ribbonMaterial);
      scene.add(ribbonV);

      // Horizontal Ribbon
      const ribbonHGeometry = new THREE.BoxGeometry(2.1, 0.3, 2.1);
      ribbonH = new THREE.Mesh(ribbonHGeometry, ribbonMaterial);
      scene.add(ribbonH);

      // Bow on top
      const bowGroup = new THREE.Group();

      const bowGeometry = new THREE.SphereGeometry(0.3, 32, 32);
      const bowCenter = new THREE.Mesh(bowGeometry, ribbonMaterial);
      bowGroup.add(bowCenter);

      const loopGeometry = new THREE.TorusGeometry(0.25, 0.1, 16, 100);
      const bowLoop1 = new THREE.Mesh(loopGeometry, ribbonMaterial);
      bowLoop1.position.x = -0.3;
      bowLoop1.rotation.y = Math.PI / 4;
      bowGroup.add(bowLoop1);

      const bowLoop2 = new THREE.Mesh(loopGeometry, ribbonMaterial);
      bowLoop2.position.x = 0.3;
      bowLoop2.rotation.y = -Math.PI / 4;
      bowGroup.add(bowLoop2);

      bowGroup.position.y = 1.2;
      bow = bowGroup;
      scene.add(bow);

      // Hide loading screen
      document.getElementById('loading').classList.add('hidden');

      // Start animation
      animate();
    }

    function animate() {
      requestAnimationFrame(animate);

      if (!isOpened) {
        giftBox.rotation.y += 0.005;
        ribbonV.rotation.y += 0.005;
        ribbonH.rotation.y += 0.005;
        bow.rotation.y += 0.005;

        // Floating effect
        const time = Date.now() * 0.001;
        giftBox.position.y = Math.sin(time) * 0.2;
        ribbonV.position.y = Math.sin(time) * 0.2;
        ribbonH.position.y = Math.sin(time) * 0.2;
        bow.position.y = 1.2 + Math.sin(time) * 0.2;
      }

      renderer.render(scene, camera);
    }

    // Click handler
    document.getElementById('three-canvas').addEventListener('click', openGift);

    function openGift() {
      if (isOpened) return;
      isOpened = true;

      document.getElementById('tapHint').classList.add('hidden');

      const music = document.getElementById('bgMusic');
      music.volume = 0.5;
      music.play().catch(() => console.log('Click to play music'));

      // GSAP Animation for opening
      gsap.to(giftBox.position, {
        y: -5,
        duration: 1.5,
        ease: 'power2.in'
      });

      gsap.to(ribbonV.position, {
        y: -5,
        duration: 1.5,
        ease: 'power2.in'
      });

      gsap.to(ribbonH.position, {
        y: -5,
        duration: 1.5,
        ease: 'power2.in'
      });

      gsap.to(bow.position, {
        y: -5,
        duration: 1.5,
        ease: 'power2.in'
      });

      gsap.to(giftBox.rotation, {
        x: Math.PI * 2,
        duration: 1.5,
        ease: 'power2.in'
      });

      // Show content after animation
      setTimeout(() => {
        document.getElementById('mainContent').classList.add('active');
        typeWriter();
        createFloatingImages(); // Trigger floating images
      }, 1000);
    }

    // ========== TYPEWRITER EFFECT ==========
    let i = 0;
    function typeWriter() {
      if (i < message.length) {
        const char = message.charAt(i);
        document.getElementById("typewriter").innerHTML +=
          char === "<" ? checkTag() : char;
        if (char !== "<") i++;
        setTimeout(typeWriter, speed);
      }
    }

    function checkTag() {
      let tag = "";
      while (message.charAt(i) !== ">") {
        tag += message.charAt(i);
        i++;
      }
      tag += ">";
      i++;
      return tag;
    }

    // ========== SETTINGS MODAL & IMAGE UPLOAD ==========
    const settingsBtn = document.getElementById('settingsBtn');
    const settingsModal = document.getElementById('settingsModal');
    const closeModal = document.getElementById('closeModal');
    const uploadArea = document.getElementById('uploadArea');
    const imageInput = document.getElementById('imageInput');
    const imagePreview = document.getElementById('imagePreview');

    let uploadedImages = [];

    // Open modal
    settingsBtn.addEventListener('click', () => {
      settingsModal.classList.add('active');
    });

    // Close modal
    closeModal.addEventListener('click', () => {
      settingsModal.classList.remove('active');
    });

    // Close modal when clicking outside
    settingsModal.addEventListener('click', (e) => {
      if (e.target === settingsModal) {
        settingsModal.classList.remove('active');
      }
    });

    // Upload area click
    uploadArea.addEventListener('click', () => {
      imageInput.click();
    });

    // Drag and drop
    uploadArea.addEventListener('dragover', (e) => {
      e.preventDefault();
      uploadArea.style.background = 'rgba(102, 126, 234, 0.2)';
    });

    uploadArea.addEventListener('dragleave', () => {
      uploadArea.style.background = 'rgba(102, 126, 234, 0.05)';
    });

    uploadArea.addEventListener('drop', (e) => {
      e.preventDefault();
      uploadArea.style.background = 'rgba(102, 126, 234, 0.05)';
      const files = e.dataTransfer.files;
      handleFiles(files);
    });

    // File input change
    imageInput.addEventListener('change', (e) => {
      handleFiles(e.target.files);
    });

    // Handle uploaded files
    function handleFiles(files) {
      Array.from(files).forEach(file => {
        if (file.type.startsWith('image/')) {
          const reader = new FileReader();
          reader.onload = (e) => {
            const imageData = e.target.result;
            uploadedImages.push(imageData);
            displayPreview(imageData, uploadedImages.length - 1);
            updateShareButton(); // Enable share button
          };
          reader.readAsDataURL(file);
        }
      });
    }

    // Display image preview
    function displayPreview(imageData, index) {
      const previewItem = document.createElement('div');
      previewItem.className = 'preview-item';
      previewItem.innerHTML = `
        <img src="${imageData}" alt="Preview ${index + 1}">
        <button class="remove-img" onclick="removeImage(${index})">√ó</button>
      `;
      imagePreview.appendChild(previewItem);
    }

    // Remove image
    window.removeImage = function (index) {
      uploadedImages.splice(index, 1);
      updatePreview();
      updateShareButton();
    };

    // Update preview display
    function updatePreview() {
      imagePreview.innerHTML = '';
      uploadedImages.forEach((imageData, index) => {
        displayPreview(imageData, index);
      });
    }

    // Update share button state
    function updateShareButton() {
      const shareBtn = document.getElementById('shareBtn');
      if (shareBtn) {
        shareBtn.disabled = uploadedImages.length === 0;
      }
    }

    // ========== SHARE LINK FUNCTIONALITY ==========
    const shareBtn = document.getElementById('shareBtn');
    const copyNotification = document.getElementById('copyNotification');

    // Generate share link
    shareBtn.addEventListener('click', () => {
      if (uploadedImages.length === 0) return;

      // Encode images to URL-safe format
      const encodedImages = uploadedImages.map(img => {
        // Remove data URL prefix and encode
        return img.replace(/^data:image\/[a-z]+;base64,/, '');
      });

      // Create URL with encoded images
      const baseUrl = window.location.origin + window.location.pathname;
      const params = new URLSearchParams();
      params.set('images', JSON.stringify(encodedImages));

      const shareUrl = `${baseUrl}?${params.toString()}`;

      // Copy to clipboard
      navigator.clipboard.writeText(shareUrl).then(() => {
        // Show notification
        copyNotification.classList.add('show');
        setTimeout(() => {
          copyNotification.classList.remove('show');
        }, 3000);
      }).catch(err => {
        // Fallback for older browsers
        const textArea = document.createElement('textarea');
        textArea.value = shareUrl;
        textArea.style.position = 'fixed';
        textArea.style.left = '-999999px';
        document.body.appendChild(textArea);
        textArea.select();
        try {
          document.execCommand('copy');
          copyNotification.classList.add('show');
          setTimeout(() => {
            copyNotification.classList.remove('show');
          }, 3000);
        } catch (err) {
          alert('Kh√¥ng th·ªÉ sao ch√©p link. Vui l√≤ng th·ª≠ l·∫°i!');
        }
        document.body.removeChild(textArea);
      });
    });

    // ========== LOAD IMAGES FROM URL ==========
    function loadImagesFromUrl() {
      const urlParams = new URLSearchParams(window.location.search);
      const imagesParam = urlParams.get('images');

      if (imagesParam) {
        try {
          const encodedImages = JSON.parse(imagesParam);

          // Decode and restore images
          encodedImages.forEach(encodedImg => {
            // Detect image type (try common formats)
            const imageTypes = ['jpeg', 'jpg', 'png', 'gif', 'webp'];
            let imageData = null;

            // Try to decode as different image types
            for (let type of imageTypes) {
              try {
                imageData = `data:image/${type};base64,${encodedImg}`;
                uploadedImages.push(imageData);
                break;
              } catch (e) {
                continue;
              }
            }
          });

          // Update preview if images were loaded
          if (uploadedImages.length > 0) {
            updatePreview();
            updateShareButton();
          }
        } catch (e) {
          console.error('Error loading images from URL:', e);
        }
      }
    }

    // Load images on page load
    loadImagesFromUrl();


    // ========== FLOATING IMAGES ANIMATION ==========
    function createFloatingImages() {
      if (uploadedImages.length === 0) return;

      const centerX = window.innerWidth / 2;
      const centerY = window.innerHeight / 2;

      // Calculate positions in a circular/orbital pattern around the content
      const positions = [];
      const numImages = uploadedImages.length;

      // Create strategic positions around the screen
      // Top positions
      positions.push(
        { x: centerX - 400, y: 100, size: 120 },
        { x: centerX + 400, y: 100, size: 110 },
        { x: centerX - 200, y: 80, size: 90 },
        { x: centerX + 200, y: 80, size: 95 }
      );

      // Middle-left and middle-right positions
      positions.push(
        { x: 100, y: centerY - 150, size: 130 },
        { x: 100, y: centerY + 150, size: 100 },
        { x: window.innerWidth - 150, y: centerY - 150, size: 125 },
        { x: window.innerWidth - 150, y: centerY + 150, size: 105 }
      );

      // Bottom positions
      positions.push(
        { x: centerX - 350, y: window.innerHeight - 120, size: 115 },
        { x: centerX + 350, y: window.innerHeight - 120, size: 110 },
        { x: centerX - 150, y: window.innerHeight - 100, size: 85 },
        { x: centerX + 150, y: window.innerHeight - 100, size: 90 }
      );

      // Additional scattered positions for more images
      positions.push(
        { x: centerX - 500, y: centerY - 100, size: 95 },
        { x: centerX + 500, y: centerY - 100, size: 100 },
        { x: centerX - 300, y: centerY + 200, size: 105 },
        { x: centerX + 300, y: centerY + 200, size: 95 }
      );

      uploadedImages.forEach((imageData, index) => {
        // Use modulo to cycle through positions if more images than positions
        const posIndex = index % positions.length;
        const pos = positions[posIndex];

        // Create image element
        const img = document.createElement('img');
        img.src = imageData;
        img.className = 'floating-image';

        // Set size with some variation
        const sizeVariation = (Math.random() - 0.5) * 20;
        const finalSize = pos.size + sizeVariation;
        img.style.width = finalSize + 'px';
        img.style.height = finalSize + 'px';
        img.style.objectFit = 'cover';

        // Start from center
        img.style.left = centerX + 'px';
        img.style.top = centerY + 'px';

        document.body.appendChild(img);

        // Calculate final position with some randomness
        const randomOffsetX = (Math.random() - 0.5) * 100;
        const randomOffsetY = (Math.random() - 0.5) * 100;
        const finalX = Math.max(50, Math.min(window.innerWidth - finalSize - 50, pos.x + randomOffsetX));
        const finalY = Math.max(50, Math.min(window.innerHeight - finalSize - 50, pos.y + randomOffsetY));

        // Burst out animation with GSAP
        gsap.to(img, {
          left: finalX,
          top: finalY,
          opacity: 0.65,
          rotation: (Math.random() - 0.5) * 30,
          scale: 1,
          duration: 1.2 + Math.random() * 0.5,
          ease: 'back.out(1.2)',
          delay: index * 0.08
        });

        // Continuous floating animation
        gsap.to(img, {
          y: '+=25',
          x: '+=15',
          rotation: '+=' + ((Math.random() - 0.5) * 20),
          repeat: -1,
          yoyo: true,
          duration: 4 + Math.random() * 2,
          ease: 'sine.inOut',
          delay: 1.2 + index * 0.08
        });

        // Subtle scale pulse
        gsap.to(img, {
          scale: 1.05,
          repeat: -1,
          yoyo: true,
          duration: 3 + Math.random() * 2,
          ease: 'sine.inOut',
          delay: 1.5 + index * 0.08
        });
      });
    }


    // ========== ENHANCED PARTICLE SYSTEM ==========
    const canvas = document.getElementById("canvas-bg");
    const ctx = canvas.getContext("2d");
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    const particles = [];

    class SnowParticle {
      constructor() {
        this.x = Math.random() * canvas.width;
        this.y = Math.random() * canvas.height;
        this.size = Math.random() * 4 + 1;
        this.speedX = Math.random() * 1 - 0.5;
        this.speedY = Math.random() * 1.5 + 0.5;
        this.opacity = Math.random() * 0.6 + 0.2;
      }
      update() {
        this.y += this.speedY;
        this.x += this.speedX;
        if (this.y > canvas.height) {
          this.y = -10;
          this.x = Math.random() * canvas.width;
        }
        if (this.x > canvas.width) this.x = 0;
        if (this.x < 0) this.x = canvas.width;
      }
      draw() {
        ctx.fillStyle = `rgba(255, 255, 255, ${this.opacity})`;
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
        ctx.fill();
      }
    }

    class SparkleParticle {
      constructor() {
        this.x = Math.random() * canvas.width;
        this.y = Math.random() * canvas.height;
        this.size = Math.random() * 2 + 1;
        this.speedX = Math.random() * 0.5 - 0.25;
        this.speedY = Math.random() * 0.5 - 0.25;
        this.opacity = Math.random();
        this.fadeSpeed = Math.random() * 0.02 + 0.01;
        this.growing = Math.random() > 0.5;
      }
      update() {
        this.x += this.speedX;
        this.y += this.speedY;

        if (this.growing) {
          this.opacity += this.fadeSpeed;
          if (this.opacity >= 1) this.growing = false;
        } else {
          this.opacity -= this.fadeSpeed;
          if (this.opacity <= 0) {
            this.growing = true;
            this.x = Math.random() * canvas.width;
            this.y = Math.random() * canvas.height;
          }
        }

        if (this.x > canvas.width) this.x = 0;
        if (this.x < 0) this.x = canvas.width;
        if (this.y > canvas.height) this.y = 0;
        if (this.y < 0) this.y = canvas.height;
      }
      draw() {
        ctx.save();
        ctx.shadowBlur = 10;
        ctx.shadowColor = `rgba(255, 215, 0, ${this.opacity})`;
        ctx.fillStyle = `rgba(255, 215, 0, ${this.opacity})`;
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
        ctx.fill();

        ctx.strokeStyle = `rgba(255, 255, 255, ${this.opacity * 0.5})`;
        ctx.lineWidth = 1;
        ctx.beginPath();
        ctx.moveTo(this.x - this.size * 2, this.y);
        ctx.lineTo(this.x + this.size * 2, this.y);
        ctx.moveTo(this.x, this.y - this.size * 2);
        ctx.lineTo(this.x, this.y + this.size * 2);
        ctx.stroke();
        ctx.restore();
      }
    }

    class HeartParticle {
      constructor() {
        this.x = Math.random() * canvas.width;
        this.y = canvas.height + 20;
        this.size = Math.random() * 15 + 10;
        this.speedY = -(Math.random() * 2 + 1);
        this.speedX = Math.random() * 1 - 0.5;
        this.opacity = Math.random() * 0.4 + 0.2;
        this.rotation = Math.random() * Math.PI * 2;
        this.rotationSpeed = (Math.random() - 0.5) * 0.05;
      }
      update() {
        this.y += this.speedY;
        this.x += this.speedX;
        this.rotation += this.rotationSpeed;
        if (this.y < -50) {
          this.y = canvas.height + 20;
          this.x = Math.random() * canvas.width;
        }
      }
      draw() {
        ctx.save();
        ctx.globalAlpha = this.opacity;
        ctx.fillStyle = '#ff6b9d';
        ctx.translate(this.x, this.y);
        ctx.rotate(this.rotation);

        ctx.beginPath();
        ctx.moveTo(0, this.size / 4);
        ctx.bezierCurveTo(-this.size / 2, -this.size / 4, -this.size, this.size / 8, 0, this.size);
        ctx.bezierCurveTo(this.size, this.size / 8, this.size / 2, -this.size / 4, 0, this.size / 4);
        ctx.fill();
        ctx.restore();
      }
    }

    for (let j = 0; j < 100; j++) particles.push(new SnowParticle());
    for (let j = 0; j < 50; j++) particles.push(new SparkleParticle());
    for (let j = 0; j < 20; j++) particles.push(new HeartParticle());

    function animateBg() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      particles.forEach((p) => {
        p.update();
        p.draw();
      });
      requestAnimationFrame(animateBg);
    }
    animateBg();

    // ========== WINDOW RESIZE ==========
    window.addEventListener("resize", () => {
      // Update canvas sizes
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;

      // Update Three.js camera and renderer
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);

      // Responsive camera positioning on resize
      if (window.innerWidth <= 375) {
        camera.position.set(0, 2, 10);
      } else if (window.innerWidth <= 575) {
        camera.position.set(0, 2, 9);
      } else if (window.innerWidth <= 767) {
        camera.position.set(0, 2, 8.5);
      } else if (window.innerWidth <= 991) {
        camera.position.set(0, 2, 8);
      } else if (window.innerWidth <= 1199) {
        camera.position.set(0, 2, 7.5);
      } else {
        camera.position.set(0, 2, 8);
      }
      camera.lookAt(0, 0, 0);
    });

    // ========== INITIALIZE ==========
    window.addEventListener('load', () => {
      initThreeJS();
    });
  </script>
</body>

</html>
```